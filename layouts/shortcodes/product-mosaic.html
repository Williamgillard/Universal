{{/* Product Mosaic Shortcode */}}
{{/* Usage: {{< product-mosaic category="electronics" limit="12" >}} */}}

{{ $category := .Get "category" | default "all" }}
{{ $limit := .Get "limit" | default 10 }}
{{ $showPrice := .Get "showPrice" | default true }}
{{ $showDescription := .Get "showDescription" | default false }}

{{ $products := slice }}
{{ if eq $category "all" }}
  {{ $products = site.Data.product }}
{{ else }}
  {{ range site.Data.product }}
    {{ if eq .category $category }}
      {{ $products = $products | append . }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if gt (len $products) 0 }}
<div class="product-mosaic">
  {{ range $index, $product := first $limit $products }}
    {{ $size := "medium" }}
    {{ $remainder := mod $index 7 }}
    {{ if eq $remainder 0 }}
      {{ $size = "large" }}
    {{ else if or (eq $remainder 3) (eq $remainder 5) }}
      {{ $size = "wide" }}
    {{ else if eq $remainder 6 }}
      {{ $size = "tall" }}
    {{ end }}
    
    <div class="product-card product-card--{{ $size }}" data-product-id="{{ .id }}">
      {{ if .image }}
        <div class="product-image">
          <img src="/img/product/{{ .image }}" alt="{{ .title }}" loading="lazy">
          <div class="product-overlay">
            <div class="product-info">
              <h3 class="product-title">{{ .title }}</h3>
              {{ if $showPrice }}
                <p class="product-price">${{ .price }}</p>
              {{ end }}
              {{ if and $showDescription .description }}
                <p class="product-description">{{ .description | truncate 100 }}</p>
              {{ end }}
              {{ if .link }}
                <a href="{{ .link }}" class="product-link">View Product</a>
              {{ else }}
                <a href="/products/{{ .id }}" class="product-link">View Product</a>
              {{ end }}
            </div>
          </div>
        </div>
      {{ else }}
        <div class="product-no-image">
          <div class="product-info">
            <h3 class="product-title">{{ .title }}</h3>
            {{ if $showPrice }}
              <p class="product-price">${{ .price }}</p>
            {{ end }}
            {{ if and $showDescription .description }}
              <p class="product-description">{{ .description | truncate 150 }}</p>
            {{ end }}
            {{ if .link }}
              <a href="{{ .link }}" class="product-link">View Product</a>
            {{ else }}
              <a href="/products/{{ .id }}" class="product-link">View Product</a>
            {{ end }}
          </div>
        </div>
      {{ end }}
    </div>
  {{ end }}
</div>

<style>
.product-mosaic {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  grid-auto-rows: 200px;
  gap: 16px;
  padding: 20px 0;
}

.product-card {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.product-card--large {
  grid-column: span 2;
  grid-row: span 2;
}

.product-card--wide {
  grid-column: span 2;
}

.product-card--tall {
  grid-row: span 2;
}

.product-image {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-image img {
  transform: scale(1.05);
}

.product-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0) 0%,
    rgba(0, 0, 0, 0.3) 60%,
    rgba(0, 0, 0, 0.8) 100%
  );
  display: flex;
  align-items: flex-end;
  padding: 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.product-card:hover .product-overlay {
  opacity: 1;
}

.product-no-image {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.product-info {
  color: white;
  text-align: center;
}

.product-title {
  font-size: 1.2em;
  font-weight: 600;
  margin: 0 0 8px 0;
  line-height: 1.3;
}

.product-card--large .product-title {
  font-size: 1.5em;
}

.product-price {
  font-size: 1.1em;
  font-weight: 700;
  color: #4ade80;
  margin: 4px 0;
}

.product-description {
  font-size: 0.9em;
  opacity: 0.9;
  margin: 8px 0;
  line-height: 1.4;
}

.product-link {
  display: inline-block;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 0.9em;
  font-weight: 500;
  margin-top: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: background 0.3s ease;
}

.product-link:hover {
  background: rgba(255, 255, 255, 0.3);
  color: white;
  text-decoration: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .product-mosaic {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    grid-auto-rows: 180px;
    gap: 12px;
  }
  
  .product-card--large {
    grid-column: span 1;
    grid-row: span 1;
  }
  
  .product-card--wide {
    grid-column: span 1;
  }
  
  .product-overlay {
    opacity: 1;
  }
}

@media (max-width: 480px) {
  .product-mosaic {
    grid-template-columns: 1fr;
    grid-auto-rows: 200px;
  }
  
  .product-card--large,
  .product-card--wide,
  .product-card--tall {
    grid-column: span 1;
    grid-row: span 1;
  }
}
</style>
{{ else }}
  <div class="no-products">
    <p>No products found{{ if ne $category "all" }} in category "{{ $category }}"{{ end }}.</p>
  </div>
{{ end }}