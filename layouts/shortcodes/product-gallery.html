<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    padding-top: 60px;
  }
  .modal-content {
    background: white;
    margin: auto;
    padding: 20px;
    max-width: 600px;
    border-radius: 8px;
    position: relative;
  }
  .modal-content img {
    width: 100%;
    height: auto;
    border-radius: 4px;
  }
  .close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
  }
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
    gap: 1rem;
  }
  .gallery-item {
    cursor: pointer;
    color: #6b46c1;
    font-weight: 600;
    border-bottom: 2px solid transparent;
    transition: border-color 0.3s;
    text-align: center;
  }
  .gallery-item:hover {
    border-color: #9f7aea;
  }
  .gallery-item img {
    max-width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }
</style>

<div class="gallery-grid">
  {{ range $name, $product := .Site.Data.products }}
    <div 
      class="gallery-item" 
      tabindex="0" 
      role="button" 
      aria-pressed="false" 
      aria-label="Open {{ $product.name }} details"
      data-name="{{ $product.name | html }}"
      data-desc="{{ $product.description | html }}"
      data-img="{{ "img/products/" | relURL }}{{ $product.image }}"
    >
      <img src="{{ "img/products/" | relURL }}{{ $product.image }}" alt="{{ $product.name }}" loading="lazy" />
      {{ $product.name }}
    </div>
  {{ end }}
</div>

<!-- Modal -->
<div id="productModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
  <div class="modal-content">
    <span class="close-btn" id="modalClose" aria-label="Close">&times;</span>
    <h2 id="modalTitle"></h2>
    <img id="modalImage" src="" alt="" />
    <p id="modalDesc"></p>
  </div>
</div>

<script>
  (function(){
    const modal = document.getElementById('productModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalImage = document.getElementById('modalImage');
    const modalClose = document.getElementById('modalClose');

    function openModal(name, desc, img) {
      modalTitle.textContent = name;
      modalDesc.textContent = desc;
      modalImage.src = img;
      modalImage.alt = name;
      modal.style.display = 'block';
      modalClose.focus();
    }

    function closeModal() {
      modal.style.display = 'none';
    }

    document.querySelectorAll('.gallery-item').forEach(item => {
      item.addEventListener('click', () => {
        openModal(
          item.getAttribute('data-name'),
          item.getAttribute('data-desc'),
          item.getAttribute('data-img')
        );
      });
      item.addEventListener('keydown', e => {
        if(e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openModal(
            item.getAttribute('data-name'),
            item.getAttribute('data-desc'),
            item.getAttribute('data-img')
          );
        }
      });
    });

    modalClose.addEventListener('click', closeModal);

    window.addEventListener('click', e => {
      if(e.target === modal) closeModal();
    });

    window.addEventListener('keydown', e => {
      if(e.key === "Escape" && modal.style.display === 'block') {
        closeModal();
      }
    });
  })();
</script>
